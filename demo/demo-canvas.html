<!DOCTYPE html>
<html>
<head>
  <title>JSCPP test</title>
</head>

<body>
  <canvas tabindex="1" id="gamecanvas" width="640" height="360" style="background: black;"></canvas>
  <p/>
</body>
<script src="../dist/JSCPP.js"></script>
<script type="text/javascript">
window.onload = function () {
  var code = `
#include <iostream>
#include <cmath>
#include <inge9>
using namespace std;

int main() {
  cout << canvasWidth() << "x" << canvasHeight() << endl;
  fillRect(0, 0, 400, 90, "red");
  drawRect(100, 100, 260, 190, "blue");
  drawLine(0, 0, 100, 100, "yellow");
  drawText("Press any key to continue", 8, 30, 22, "white");
  readKey();
  clear("black");
  drawText(lastKey(), 8, 30, 22, "white");
  if (lastKeyWas("Enter")) {
    cout << "Enter" << endl;
  }
  
  loadImage("tileset", "https://opengameart.org/sites/default/files/set_0.gif");
  loadImage("panda", "https://upload.wikimedia.org/wikipedia/commons/b/bf/Farm-Fresh_emotion_face_panda.png");
  loadImage("hero", "https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/Cc-by_new_white.svg/48px-Cc-by_new_white.svg.png");
  loadImage("block", "https://upload.wikimedia.org/wikipedia/commons/3/3d/8X8_GEOLOC.png");
  waitUntilResourcesLoad();
  cout << "loaded all images" << endl;

  double x = 180, y = 120, delta = 4;
  double heroy = 200;
  int i = 0;
  for (;;) {
    clear("black");
    if (isKeyDown("ArrowLeft")) x -= delta;
    if (isKeyDown("ArrowRight")) x += delta;
    if (isKeyDown("ArrowUp")) y -= delta;
    if (isKeyDown("ArrowDown")) y += delta;
    if (isKeyDown(" ")) {
      heroy += 5;
      clearKey(" ");
    }
  
    drawText(lastKey(), 8, 30, 22, "white");

    drawText(mouseX(), 8, 60, 22, "white");
    drawText(mouseY(), 8, 90, 22, "white");
    
    for (int x = 0; x < 3; x++) {
      for (int y = 0; y < 3; y++) {
        drawImageRect("tileset", 100 + 16 * x, 100 + 16 * y, x * 16, y * 16, 16, 16);
      }
    }

    drawImageTile("tileset", 50, 50, 16, 16, i / 6);
    i = (i + 1) % (256 * 6);
    
    drawImage("hero", 400, heroy);
    drawImage("block", 400, 200);
    drawImage("panda", x, y);
    delay(30);
  }
  
  return 0;
}`
  
  async function run(config) {
    config = config || {};
    if (!('stdio' in config)) {
      config.stdio = {
        write: function(s) {
          console.log(s);
        }
      }
    }
    config.debug = true;
    let mydebugger = JSCPP.run(code, '', config);
    let finished = false;
    do {
      window.debuggerPromise = undefined;
      finished = mydebugger.next();
      if (window.debuggerPromise) {
        await window.debuggerPromise;
      }
    } while (finished == false);
  }

  document.getElementById("gamecanvas").focus();
  run();
}
</script>
</html>